---
title: "3. Setup Edge Server"
sidebar_position: 8
description: "The Edge."
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Edge Server

The Edge module is designed as a simple Edge proxy and cache node for TUM-Live/worker. When network traffic to worker nodes exceeds the available bandwidth, the architecture might look like this:

```
                                                ┌───────┐ proxy /stream1.m3u8
┌─────────────────┐                         ┌─► │Edge 1 ├──────────────────────────┐  ┌───────────┐
│                 ├─────────────────────────┘   └───────┘                          └─►│           │
│  Load Balancer  │GET /worker-n/stream1.m3u8                                         │ worker-n  │
│(DNS-RR/HTTP 302)│GET /worker-n/media123.ts                                          │           │
│                 ├─────────────────────────┐   ┌───────┐                          ┌─►└───────────┘
└─────────────────┘                         └─► │Edge 2 ├──────────────────────────┘
                                                └───────┘ proxy & cache /media123.ts
```

## Configuration

The following configuration options are available via environment variables:

- `PORT`: The port on which the Edge node should listen for incoming connections (default: 8090).
- `ORIGIN_PORT`: The port on which the Worker's HLS files are available (default: 8085).
- `ORIGIN_PROTO`: The protocol of the origin server (default: HTTP).
- `CERT_DIR`: If specified, the Edge node will use the files ending with `fullchain.pem` and `privkey.pem` in this directory to serve HTTPS connections on port `8443`.
- `VOD_DIR`: A directory that is statically served under the path `/vod` to access VoDs generated by the VoD Service`. Defaults to `/vod`
- `MAIN_INSTANCE`: The URL where your TUM-Live instance is available. Used for public key exchange. Defaults to `http://localhost:8081`
- `ADMIN_TOKEN`: Can be used in place of the `?jwt` query parameter to authenticate for streams. No default value set.
  :::warning
  Keep your admin token secret, as it can be used to access any recordings on your Edge Server. You can change the token any time by re-deploying your Edge Server.
  :::

## Setup Edge Server

<Tabs
  defaultValue="docker"
  values={[
    {label: 'Docker', value: 'docker'},
    {label: 'Manually', value: 'manually'},
  ]
}>

<TabItem value="docker">

Start the Edge Server:

```sh
  docker run -d \
  -p 80:8090 \
  -p 443:8443 \
  -e CERT_DIR=/cert/ \
  -e VOD_DIR=/vod/ \
  -e MAIN_INSTANCE=http://live.carlobortolan.com \
  -e ADMIN_TOKEN=<insert-your-admin-token> \
  -e PORT=8090 \
  -v /path/to/vod:/vod \
  -v /path/to/cert:/cert \
  docker.io/carlobortolan/edge:latest
```

</TabItem>

<TabItem value="manually">

1. Clone the GoCast repository:
   ```sh
   git clone https://github.com/tum-Dev/gocast
   ```
2. Change into the Edge directory:

   ```sh
   cd gocast && cd worker/edge
   ```

3. Start the Edge Server:
   ```sh
   TODO
   ```

</TabItem>

</Tabs>

## Test Edge Server

To test that the Edge is working as expected, upload a sample video (e.g., `Exiting_video.mp4`) to your storage and try to access it:

```sh
curl <your-edge-server-addr>/vod/Exiting_video.mp4/playlist.m3u8?jwt=<jwt>
```

This should only return the video / playlist file if the JWT is valid.
